{{Short description|Pathfinding problem}}
[[File:Example of Multi-Agent Path Finding in a grid environment.png|thumb|right|upright=1.1|Example of Multi-Agent Path Finding in a grid environment.]]

The problem of '''Multi-Agent Path Finding (MAPF)''' is an instance of [[multi-agent planning]] and consists in the computation of collision-free paths for a group of agents from their location to an assigned target. It is an [[optimization problem]], since the aim is to find those paths that optimize a given objective function, usually defined as the number of time steps until all agents reach their goal cells. MAPF is the multi-agent generalization of the [[pathfinding]] problem, and it is closely related to the [[shortest path problem]] in the context of [[graph theory]].

Several algorithms have been proposed to solve the MAPF problem. Due to its complexity, it happens that optimal approaches are infeasible on big environments and with a high number of agents. However, given the applications in which MAPF is involved such as automated warehouses and airport management, it is important to reach a trade-off between the efficiency of the solution and its effectiveness.

== Problem Formalization ==
The elements of a classical MAPF <ref name = "stern">{{cite journal |last1=Stern |first1=Roni |last2=Sturtevant |first2=Nathan R. |last3=Felner |first3=Ariel |last4=Koenig |first4=Sven |last5=Ma |first5=Hang |last6=Walker |first6=Thayne |last7=Li |first7=Jiaoyang |last8=Atzmon |first8=Dor |last9=Cohen |first9=Liron |last10=Kumar |first10=T. K. Satish |last11=Boyarski |first11=Eli |last12=Barták |first12=Roman |title=Multi-Agent Pathfinding: Definitions, Variants, and Benchmarks |date=2019 |url=http://mapf.info/index.php/Main/Tutorials?action=download&upname=socs19a.pdf}}</ref>  problem are the following:

* a set <math> A = \{1,2,...,k\} </math> of <math> k </math> agents;
* an undirected [[Graph (discrete mathematics)|graph]] <math> G=(V,E) </math>, where <math> V </math> is the node set, and <math> E </math> is the edge set. The nodes represent the possible locations of the agents, while the arcs are the possible connections between such positions;
* a map <math> s: A \to V </math> that associates each agent with its starting point;
* a map <math> t: A \to V </math> that associates each agent with its target point.

It is assumed that time is discrete, and that each agent can perform one action at each time step. There are two possible types of actions: the wait action, in which the agent remains in its node, and the move action, that allows the agent to move to an adjacent node. An action is formalized as a function <math> a : V \to V </math>, meaning that <math> a(v) = v' </math> represents the action of moving from <math> v </math> to <math> v' </math> if <math> v' </math> is adjacent to <math> v </math> and different than <math> v' </math>, or to stay in node <math> v </math> if <math> v = v' </math>.

The agents perform sequences of actions to go from their starting point to their target location. A sequence of action performed by agent <math> i </math> is denoted by <math> \pi_i = (a_1, a_2,..., a_n) </math> and is called a plan. If agent <math> i </math> starts from its location <math> s(i) </math> and arrives to its target location <math> t(i) </math> performing plan <math> \pi_i </math>, then <math> \pi_i </math> is called single-agent plan for agent <math> i </math>.<ref name="stern" /> A valid solution for the MAPF problem is a set of <math> k </math> single-agent plans (one for each agent), such that the plans do not collide one another. Once an agent has reached its target, it can either remain in the target location or disappear.<ref name="stern" />

=== Types of Collisions ===
In order to have a valid solution for a MAPF problem, it is necessary that the single-agent plans of the <math> k </math> agents do not collide one another. Given plan <math> \pi_i </math>, the expression <math> \pi_i[x] </math> denotes the position of agent <math> i </math> after having performed <math> x </math> steps of plan <math> \pi_i </math>. It is possible to distinguish five different types of collisions between two plans <math> \pi_i </math> and <math> \pi_j </math>.<ref name="stern" />

[[File:Types of agents' conflicts in a grid environment.png|thumb|right|upright=2|Types of conflicts: (a) is an edge conflict, (b) a vertex conflict, (c) a following conflict, (d) a cycle conflict, and (e) a swapping conflict.]]

* Vertex conflict: there is a vertex conflict between plans <math> \pi_i </math> and <math> \pi_j </math> when the two agents occupy the same location at the same time. Formally, a vertex conflict happens when <math> \pi_i[x] = \pi_j[x] </math>. 
* Edge conflict: an edge conflict occurs whenever two agents cross the same edge in the same direction at the same time, that is <math> \pi_i[x] = \pi_j[x] </math> and <math> \pi_i[x+1] = \pi_j[x+1] </math>. If vertex conflicts are not allowed, then edge conflicts cannot exist.
* Following conflict: a following conflict happens when at a certain time step an agent occupies a location that was occupied by another agent in the previous time step. Mathematically, a following conflict is described as <math> \pi_i[x+1] = \pi_j[x] </math>.
* Cycle conflict: a cycle conflict happens whenever a set of agents (at least three) move as if they are spinning in a cycle. It means that each agent takes the position that was previously occupied by the other agent one step-ahead in the cycle. If following conflicts are forbidden, then cycle conflicts cannot happen.
* Swapping conflict: a swapping conflict is the case in which two agents exchange their position, passing on the same edge at the same time in two different directions. It is expressed as <math> \pi_i[x+1] = \pi_j[x] </math> and <math> \pi_j[x+1] = \pi_i[x] </math>.

When formalizing a MAPF problem, it is possible to decide which conflicts are allowed and which are forbidden. A unified standard about permitted and denied conflicts does not exist, however vertex and edge conflicts are udually not allowed.<ref name="stern" />

=== Objective Functions ===
When computing single-agent plans, the aim is to maximize a user-defined objective function. There is not a standard objective function to adopt, however the most common are:<ref name="stern" />

* flowtime: this measure is obtained by summing the time steps employed by each agent to reach their target location. Formally, it is equal to <math> \sum_{i \in A} |\pi_i| </math>, where the plans <math> \pi_i, i \in A </math> are single-agent plans without collisions;
* makespan: the number of time steps necessary so that all the agents complete theirs tasks, defined as <math> \max_{i \in A} |\pi_i| </math>, where <math> \pi_i</math><math>, i \in A </math> are part of a valid solution;
* maximization of reached targets given a deadline: the aim is to find a valid solution that maximizes the number of agents that reach their target given a time deadline.<ref name="deadline">{{cite arXiv |last1=Ma |first1=Hang |last2=Wagner |first2=Glenn |last3=Felner |first3=Ariel |last4=Li |first4=Jiaoyang |last5=Kumar |first5=T. K. Satish |last6=Koenig |first6=Sven |title=Multi-Agent Path Finding with Deadlines |date=2018 |class=cs.AI |eprint=1806.04216}}</ref>

== Algorithms ==
Several algorithms have been proposed to solve the MAPF problem. The issue is that it is [[NP-hardness|NP-hard]] to find [[optimal]] makespan or flow-time solutions,<ref name="nphard">{{cite journal |last1=Yu |first1=Jingjin |last2=LaValle |first2=Steven M. |title=Structure and intractability of optimal multi-robot path planning on graphs |journal=AAAI'13: Proceedings of the Twenty-Seventh AAAI Conference on Artificial Intelligence |date=2013 |volume=27 |pages=1443–1449 |doi=10.1609/aaai.v27i1.8541 |s2cid=11655439 |url=https://dl.acm.org/doi/10.5555/2891460.2891662}}</ref> also when considering [[planar graph]]s,<ref name="planar">{{cite journal |last1=Yu |first1=Jingjin |title=Intractability of Optimal Multirobot Path Planning on Planar Graphs |journal=IEEE Robotics and Automation Letters |date=January 2016 |volume=1 |issue=1 |pages=33–40 |doi=10.1109/LRA.2015.2503143|arxiv=1504.02072 |s2cid=10275469 }}</ref> or graphs similar to grids.<ref>{{cite journal |last1=Banfi |first1=Jacopo |last2=Basilico |first2=Nicola |last3=Amigoni |first3=Francesco |title=Intractability of Time-Optimal Multirobot Path Planning on 2D Grid Graphs with Holes |journal=IEEE Robotics and Automation Letters |date=October 2017 |volume=2 |issue=4 |pages=1941–1947 |doi=10.1109/LRA.2017.2715406|s2cid=36801258 }}</ref> For what concerns bounded suboptimal solutions, it is shown that it is NP-hard to find a makespan-optimal solution with a factor of suboptimality smaller than <math> \tfrac{4}{3}</math>.<ref>{{cite journal |last1=Ma |first1=Hang |last2=Tovey |first2=Craig |last3=Sharon |first3=Guni |last4=Kumar |first4=T. K. |last5=Koenig |first5=Sven |title=Multi-Agent Path Finding with Payload Transfers and the Package-Exchange Robot-Routing Problem |journal=Proceedings of the AAAI Conference on Artificial Intelligence |date=5 March 2016 |volume=30 |issue=1 |doi=10.1609/aaai.v30i1.10409|s2cid=1585005 }}</ref> Optimal MAPF solvers return high quality solutions, but their efficiency is low. Instead, bounded-suboptimal and suboptimal solvers are more efficient, but their solutions are less effective. Also [[machine learning]] approaches have been proposed to solve the MAPF problem.<ref name="rl">{{cite journal |last1=Sartoretti |first1=Guillaume |last2=Kerr |first2=Justin |last3=Shi |first3=Yunfei |last4=Wagner |first4=Glenn |last5=Kumar |first5=T. K. Satish |last6=Koenig |first6=Sven |last7=Choset |first7=Howie |title=PRIMAL: Pathfinding via Reinforcement and Imitation Multi-Agent Learning |journal=IEEE Robotics and Automation Letters |date=July 2019 |volume=4 |issue=3 |pages=2378–2385 |doi=10.1109/LRA.2019.2903261|s2cid=52191178 }}</ref>

=== Prioritized Planning ===
One possible approach to face the computational complexity is prioritized planning.<ref name="prpl">{{cite journal |last1=Cap |first1=Michal |last2=Novak |first2=Peter |last3=Kleiner |first3=Alexander |last4=Selecky |first4=Martin |title=Prioritized Planning Algorithms for Trajectory Coordination of Multiple Mobile Robots |journal=IEEE Transactions on Automation Science and Engineering |date=July 2015 |volume=12 |issue=3 |pages=835–849 |doi=10.1109/TASE.2015.2445780|s2cid=347488 |url=http://resolver.tudelft.nl/uuid:4955cbc8-9815-4a88-b52a-2c4eacafd69a }}</ref> It consists in decoupling the MAPF problem into <math> k </math> [[Pathfinding|single-agent pathfinding]] problems.

The first step is to assign to each agent a unique number <math> \{1,2,...,k\} </math> that corresponds to the priority given to the agent. Then, following the priority order, for each agent a plan is computed to reach the target location. When planning, agents have to avoid collisions with paths of other agents with a higher priority that have already computed their plans.

Finding a solution for the MAPF problem in such setting corresponds to the [[shortest path problem]] in a time-expansion graph.<ref>{{cite journal |last1=Silver |first1=David |title=Cooperative Pathfinding |journal=Proceedings of the AAAI Conference on Artificial Intelligence and Interactive Digital Entertainment |date=2021 |volume=1 |issue=1 |pages=117–122 |url=https://ojs.aaai.org/index.php/AIIDE/article/view/18726/18503}}</ref> A time-expansion graph is a graph that takes into account the passing of time. Each node is composed by two entries <math> (v,t) </math>, where <math> v </math> is the node name and <math> t </math> is the time step. Each node <math> (v,t) </math> is linked to the nodes <math> (u,t+1) </math> such that <math> u </math> is adjacent to <math> v </math> and <math> u </math> is not occupied at time step <math> t+1 </math>.

The drawback of prioritized planning is that, even if it is a sound approach (it returns valid solutions), it is neither optimal nor complete.<ref name="overview">{{cite journal |last1=Stern |first1=Roni |title=Multi-Agent Path Finding – An Overview |journal=Artificial Intelligence |series=Lecture Notes in Computer Science |date=2019 |volume=11866 |pages=96–115 |doi=10.1007/978-3-030-33274-7_6|isbn=978-3-030-33273-0 |s2cid=204832267 }}</ref> This means that it is not assured that the algorithm will return a solution and, even in that case, the solution may not be optimal.

=== Optimal MAPF Solvers ===
It is possible to distinguish four different categories of optimal MAPF solvers:<ref name="overview"/>
* Extensions of [[A* search algorithm|A*]]: algorithms in this category employ modified versions of the [[A* search algorithm|A*]] approach.
* Increasing Cost Tree Search:<ref>{{cite journal |last1=Sharon |first1=Guni |last2=Stern |first2=Roni |last3=Goldenberg |first3=Meir |last4=Felner |first4=Ariel |title=The increasing cost tree search for optimal multi-agent pathfinding |journal=Artificial Intelligence |date=February 2013 |volume=195 |pages=470–495 |doi=10.1016/j.artint.2012.11.006}}</ref> a novel formalization of the MAPF problem is proposed, that comprehends an increasing search tree and the corresponding algorithm. The algorithm is composed by two levels and relies on the assumption that a valid solution for the MAPF problem is composed by a set of solutions for the single agents.
* Conflict-Based Search:<ref name="cbs">{{cite journal |last1=Sharon |first1=Guni |last2=Stern |first2=Roni |last3=Felner |first3=Ariel |last4=Sturtevant |first4=Nathan R. |title=Conflict-based search for optimal multi-agent pathfinding |journal=Artificial Intelligence |date=February 2015 |volume=219 |pages=40–66 |doi=10.1016/j.artint.2014.11.006}}</ref> this algorithm computes paths as when solving single-agent pathfinding problems, and then it adds constraints in an incremental way in order to avoid collisions.
* [[Constraint programming|Constraints programming]]:<ref name="ics">{{cite journal |last1=Bartak |first1=Roman |last2=Zhou |first2=Neng-Fa |last3=Stern |first3=Roni |last4=Boyarski |first4=Eli |last5=Surynek |first5=Pavel |title=Modeling and Solving the Multi-agent Pathfinding Problem in Picat |journal=2017 IEEE 29th International Conference on Tools with Artificial Intelligence (ICTAI) |date=November 2017 |pages=959–966 |doi=10.1109/ICTAI.2017.00147|isbn=978-1-5386-3876-7 |s2cid=7819470 }}</ref> with this kind of approach, MAPF problems are transformed into a set of constraints and then solved using specific constraint solvers such as [[SAT solver|SAT]] and [[Mixed integer programming|Mixed Integer Programming]] (MIP) solvers.

=== Bounded Suboptimal MAPF Solvers ===
Bounded suboptimal algorithms offer a trade-off between the optimality and the cost of the solution. They are said to be bounded by a certain factor because they return solutions with a cost at most equal to the optimal solution cost times the factor. MAPF bounded suboptimal solvers can be divided following the same categorization presented for optimal MAPF solvers.<ref name="overview"/>

== Variations ==
The way in which MAPF problems are defined allows to change various aspects, for example the fact of being in a grid environment or the assumption that time is discrete. This section reports some variations of the classical MAPF problem.

=== Anonymous MAPF ===
It is a version of MAPF in which there is a set of target locations but agents are not assigned a specific target.<ref>{{cite journal |last1=Kloder |first1=S. |last2=Hutchinson |first2=S. |title=Path planning for permutation-invariant multirobot formations |journal=IEEE Transactions on Robotics |date=August 2006 |volume=22 |issue=4 |pages=650–665 |doi=10.1109/TRO.2006.878952|s2cid=62805494 }}</ref> It does not matter whether the agent that reaches the target, the important thing is that targets are completed. A slight modification of this version is the one in which agents are divided into groups and each group has to perform a set of targets.<ref>{{cite arXiv |last1=Ma |first1=Hang |last2=Koenig |first2=Sven |title=Optimal Target Assignment and Path Finding for Teams of Agents |date=2016 |class=cs.AI |eprint=1612.05693}}</ref>

=== Multi-Agent Pick-up and Delivery ===
MAPF problem is not able to capture some aspects relative to real world applications. For example, in automated warehouses it happens that robots have to complete several tasks one after the other. For this reason, an extended MAPF version is proposed, called Multi-Agent Pick-up and Delivery (MAPD).<ref name="Lifelong">{{cite arXiv |last1=Ma |first1=Hang |last2=Li |first2=Jiaoyang |last3=Kumar |first3=T. K. Satish |last4=Koenig |first4=Sven |title=Lifelong Multi-Agent Path Finding for Online Pickup and Delivery Tasks |date=30 May 2017 |class=cs.AI |eprint=1705.10868}}</ref> In a MAPD setting, agents have to complete a stream of tasks, where each task is composed by a pick-up a location and a delivery location. When planning for the completion of a task, the path has to start from the current position of the robot and to end in the delivery position of the task, passing through the pick-up point. MAPD is considered a "lifelong" version of MAPF in which tasks arrive incrementally.<ref name="Lifelong"/>

=== Beyond Classical MAPF ===
The assumptions that the agents are in a grid environment, that their speed is constant and that time is discrete are simplifying hypotheses. Many works take into account the kinematic constraints of agents,<ref name="kinematics">{{cite journal |last1=Hoenig |first1=Wolfgang |last2=Kumar |first2=T. K. Satish |last3=Cohen |first3=Liron |last4=Ma |first4=Hang |last5=Xu |first5=Hong |last6=Ayanian |first6=Nora |last7=Koenig |first7=Sven |title=Multi-Agent Path Finding with Kinematic Constraints |date=2016 |url=https://www.aaai.org/ocs/index.php/ICAPS/ICAPS16/paper/view/13183/12711}}</ref> such as velocity and orientation, or go past the assumption that the weights of the arcs are all equal to 1.<ref name="arcw">{{cite journal |last1=Barták |first1=Roman |last2=Švancara |first2=Jiří |last3=Vlk |first3=Marek |title=A scheduling-based approach to multi-agent path finding with weighted and capacitated arcs |journal=Proceedings of the 17th International Conference on Autonomous Agents and MultiAgent Systems |date=2018 |pages=748–756 |url=http://svancara.net/files/aamas2018.pdf}}</ref> Other works focus on eliminating the discrete time assumptions and that the duration of actions is exactly equal to one time step.<ref name="timecont">{{cite journal |last1=Andreychuk |first1=Anton |last2=Yakovlev |first2=Konstantin |last3=Surynek |first3=Pavel |last4=Atzmon |first4=Dor |last5=Stern |first5=Roni |title=Multi-agent pathfinding with continuous time |journal=Artificial Intelligence |date=April 2022 |volume=305 |pages=103662 |doi=10.1016/j.artint.2022.103662|arxiv=1901.05506 |s2cid=207791641 }}</ref> Another assumption that does not reflect reality is that agents occupy exactly one cell of the environment in which they are: some studies have been conducted to overcome this hypothesis.<ref>{{cite journal |last1=Li |first1=Jiaoyang |last2=Surynek |first2=Pavel |last3=Felner |first3=Ariel |last4=Ma |first4=Hang |last5=Kumar |first5=T. K. Satish |last6=Koenig |first6=Sven |title=Multi-Agent Path Finding for Large Agents |journal=Proceedings of the AAAI Conference on Artificial Intelligence |date=17 July 2019 |volume=33 |pages=7627–7634 |doi=10.1609/aaai.v33i01.33017627|s2cid=53687939 }}</ref> It is interesting to note that the shape and geometry of agents may introduce new types of conflicts, since agents may crash with one another even if they are not completely overlapped.

== Applications ==
MAPF can be applied in several real case scenarios:
* [[Automated warehouse]]s: warehouse logistics represents the main industrial application of MAPF. It has been shown that automation in warehouses manages to increase the productivity level.<ref name="kiva">{{cite journal |last1=Wurman |first1=Peter R. |last2=D'Andrea |first2=Raffaello |last3=Mountz |first3=Mick |title=Coordinating Hundreds of Cooperative, Autonomous Vehicles in Warehouses |journal=AI Magazine |date=20 March 2008 |volume=29 |issue=1 |pages=9 |doi=10.1609/aimag.v29i1.2082}}</ref>
* Airport operations: MAPF algorithms can be employed in crowded airports to coordinate towing vehicles that transport aircraft.<ref name="airport">{{cite journal |last1=Morris |first1=Robert |last2=Pasareanu |first2=Corina S. |last3=Luckow |first3=Kasper |last4=Malik |first4=Waqar |last5=Ma |first5=Hang |last6=Kumar |first6=T. K. Satish |last7=Koenig |first7=Sven |title=Planning, Scheduling and Monitoring for Airport Surface Operations |journal=AAAI Workshop: Planning for Hybrid Systems |date=2016 |url=https://www.aaai.org/ocs/index.php/WS/AAAIW16/paper/view/12611/12430}}</ref> Being able to optimize this kind of problems provides also a benefit to the environment.
* Autonomous mobile [[service robot]]s: service robots are automated agents that perform dangerous and repetitive tasks for humans in a non-industrial environment.<ref name="cobots">{{cite journal |last1=Veloso |first1=Manuela |last2=Biswas |first2=Joydeep |last3=Coltin |first3=Brian |last4=Rosenthal |first4=Stephanie |title=CoBots: Robust Symbiotic Autonomous Mobile Service Robots |date=2015 |url=https://www.aaai.org/ocs/index.php/IJCAI/IJCAI15/paper/view/10890/11550}}</ref> Their main goal is to help human beings.  
* Video games: the usefulness of MAPF in such settings can be found when the player has to move a team of agents in a congested video game environment.<ref>{{cite journal |last1=Ma |first1=Hang |last2=Yang |first2=Jingxing |last3=Cohen |first3=Liron |last4=Kumar |first4=T. K. Satish |last5=Koenig |first5=Sven |title=Feasibility Study: Moving Non-Homogeneous Teams in Congested Video Game Environments |date=2017 |url=https://www.aaai.org/ocs/index.php/AIIDE/AIIDE17/paper/view/15845/15178}}</ref>

== See also ==
* [[Multi-agent system]]s
* [[Multi-agent planning]]
* [[Pathfinding]]
* [[Shortest path problem]]

== Notes ==
<references />

== External links ==
* [http://mapf.info/index.php/Main/HomePage MAPF.info]

[[Category:Multi-agent systems]]